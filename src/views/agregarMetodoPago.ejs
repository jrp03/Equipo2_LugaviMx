<% layout('layout/layout.ejs') %>

<div class="container mt-5">
  <div class="card shadow">
    <div class="card-header bg-success text-white">
      <h3 class="mb-0">Agregar Método de Pago</h3>
    </div>
    <div class="card-body">
      <form action="/perfil/agregar-metodo-pago" method="POST">
        <div class="mb-3">
<label class="form-label">Tipo de tarjeta</label>
<select class="form-control" name="cardType" required>
  <option value="">-- Selecciona un tipo de tarjeta --</option>
  <option value="visa">Visa</option>
  <option value="mastercard">MasterCard</option>
  <option value="amex">American Express</option>
</select>

        </div>

        <div class="mb-3">
          <label class="form-label">Número de tarjeta</label>
          <input type="text"
       class="form-control"
       name="cardNumber"
       id="cardNumber"
       placeholder="1234 5678 9012 3456"
       maxlength="19"
       inputmode="numeric"
       pattern="\d{4} \d{4} \d{4} \d{4}"
       required>
<small class="form-text text-muted">16 dígitos, solo números. Se insertarán espacios automáticamente.</small>

        </div>

        <div class="mb-3">
          <label class="form-label">Fecha de expiración (MM/AA)</label>
          <input type="text" class="form-control" name="expiryDate" placeholder="MM/AA" required>
        </div>

        <div class="mb-3">
          <label class="form-label">CVV</label>
          <input type="text" class="form-control" name="cvv" placeholder="123" required>
        </div>

        <div class="mb-3">
          <label class="form-label">Nombre del titular</label>
          <input type="text" class="form-control" name="cardholderName" placeholder="Nombre como aparece en la tarjeta" required>
        </div>

        <div class="d-flex justify-content-between mt-4">
          <a href="/perfil" class="btn btn-outline-secondary">Cancelar</a>
          <button type="submit" class="btn btn-success">Guardar Método</button>
        </div>
        <script>
document.addEventListener('DOMContentLoaded', () => {
  const cardInput = document.getElementById('cardNumber');

  cardInput.addEventListener('input', () => {
    let value = cardInput.value.replace(/\D/g, ''); // Solo números
    value = value.substring(0, 16); // Máximo 16 dígitos

    const spaced = value.match(/.{1,4}/g); // Divide en grupos de 4
    cardInput.value = spaced ? spaced.join(' ') : '';
  });

  cardInput.addEventListener('keydown', (e) => {
    const key = e.key;
    if (!/\d/.test(key) && key !== 'Backspace' && key !== 'ArrowLeft' && key !== 'ArrowRight') {
      e.preventDefault(); // Bloquea todo excepto números y navegación
    }
  });
});
</script>

      </form>
    </div>
  </div>
</div>
